<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>PVP TIERS | Official Rankings</title>
    <meta name="description" content="Official Player Rankings and Kit Tiers.">
    <meta property="og:title" content="PVP TIERS">
    <meta property="og:description" content="View the global leaderboards and official Tier rankings.">
    <meta property="og:image" content="backgroundsword.png">
    <meta name="theme-color" content="#a855f7">
    <link rel="icon" type="image/png" href="backgroundsword.png">

    <style>
        @font-face { font-family: 'MultiCraftFont'; src: url('MultiCraftFont.ttf'); }
        :root {
            --bg: #030406; 
            --purple: #a855f7; 
            --glow: 0 0 15px rgba(168, 85, 247, 0.6);
            --t1: #ff4d4d;
        }

        body { 
            background: var(--bg); 
            color: #fff; 
            font-family: 'Courier New', monospace; 
            margin: 0; 
            overflow-x: hidden; 
            user-select: none;
        }

        /* Moving Kit Images Background */
        #star-field {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            pointer-events: none;
        }
        .moving-kit {
            position: absolute;
            width: 30px;
            height: 30px;
            background-image: url('emerald.png');
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.3;
            filter: drop-shadow(0 0 5px var(--purple));
            animation: moveKit 20s linear infinite;
        }
        @keyframes moveKit {
            from { transform: translateY(110vh) rotate(0deg); }
            to { transform: translateY(-10vh) rotate(360deg); }
        }

        /* Neon Search Bar */
        .search-wrapper {
            display: flex;
            justify-content: center;
            padding: 40px 0;
        }
        .neon-search {
            background: rgba(168, 85, 247, 0.05);
            border: 2px solid var(--purple);
            padding: 15px 30px;
            border-radius: 50px;
            width: 400px;
            color: #fff;
            font-size: 1.1rem;
            text-align: center;
            outline: none;
            box-shadow: var(--glow), inset var(--glow);
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .neon-search:focus {
            width: 500px;
            box-shadow: 0 0 30px var(--purple);
            background: rgba(168, 85, 247, 0.1);
        }

        /* Buttons */
        .kit-btn {
            background: transparent;
            border: 1px solid var(--purple);
            color: #fff;
            padding: 12px 25px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
            text-transform: uppercase;
            box-shadow: var(--glow);
            margin: 5px;
        }
        .kit-btn:hover, .kit-btn.active {
            background: var(--purple);
            color: #000;
            transform: translateY(-3px);
            box-shadow: 0 0 25px var(--purple);
        }

        /* Tiers UI */
        .tier-scroll { 
            display: flex; gap: 20px; overflow-x: auto; padding: 20px 0; 
            scrollbar-width: none;
        }
        .tier-col { 
            flex: 0 0 320px; 
            background: rgba(255, 255, 255, 0.02); 
            border: 1px solid var(--border);
            border-top: 4px solid var(--purple);
            backdrop-filter: blur(10px);
        }
        .tier-label { 
            text-align: center; padding: 15px; font-weight: bold; 
            background: rgba(168, 85, 247, 0.1); font-size: 1.2rem;
        }

        .p-row { 
            display: flex; justify-content: space-between; padding: 15px 20px; 
            border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; 
        }
        .p-row:hover { background: rgba(168, 85, 247, 0.2); }

        /* Navigation */
        nav { 
            display: flex; justify-content: center; gap: 40px; padding: 25px; 
            background: rgba(0,0,0,0.8); border-bottom: 1px solid var(--purple);
        }
        .nav-link { 
            color: #888; cursor: pointer; font-weight: bold; letter-spacing: 2px; 
            transition: 0.3s;
        }
        .nav-link:hover, .nav-link.active { color: var(--purple); text-shadow: var(--glow); }

        /* Modal */
        .modal { 
            display:none; position:fixed; inset:0; z-index:9999; 
            background:rgba(0,0,0,0.95); align-items:center; justify-content:center; 
        }
        .modal-box { 
            background: #000; border: 2px solid var(--purple); padding: 50px; 
            text-align: center; box-shadow: 0 0 50px var(--purple);
            animation: openModal 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes openModal { from { transform: scale(0.5); opacity: 0; } }
    </style>
</head>
<body>

<div id="star-field"></div>

<nav>
    <span class="nav-link active" onclick="showTab('rankings')">Rankings</span>
    <span class="nav-link" onclick="showTab('info')">Information</span>
    <span class="nav-link" onclick="showTab('hof')">Hall of Fame</span>
</nav>

<div class="search-wrapper">
    <input type="text" id="mainSearch" class="neon-search" placeholder="Click to Search Player" oninput="doSearch()" onfocus="this.placeholder='Type Name...'">
</div>

<div class="container" style="max-width: 1400px; margin: auto; padding: 0 20px;">
    <div id="rankings-tab">
        <div id="kitBar" style="display:flex; justify-content:center; flex-wrap:wrap; margin-bottom:40px;"></div>
        <div id="tierDisplay"></div>
    </div>

    <div id="info-tab" style="display:none; text-align:left; line-height:2.5;">
        <div class="tier-col" style="width:100%; padding:40px; box-sizing:border-box;">
            <h2 style="color:var(--purple); border-bottom:1px solid var(--purple);">SERVER RULES</h2>
            1. No unfair advantages (Hacks, macros)<br>
            2. Respect Tiertesters
        </div>
    </div>

    <div id="hof-tab" style="display:none;">
        <div id="hofDisplay" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:20px;"></div>
    </div>
</div>

<div id="pModal" class="modal">
    <div class="modal-box">
        <h2 id="modalName" style="font-size:3rem; margin:0; color:var(--purple);"></h2>
        <div id="modalStats" style="margin:20px 0; font-size:1.2rem;"></div>
        <button onclick="closeP()" style="background:var(--purple); border:none; padding:10px 30px; cursor:pointer; font-weight:bold; margin-top:20px;">CLOSE PROFILE</button>
    </div>
</div>

<script>
let DATA = {}; let OVERALL = {}; let curKit = "Overall";

// #2 Fix: Moving Kit Background
function createKits() {
    const container = document.getElementById('star-field');
    for(let i=0; i<15; i++) {
        const kit = document.createElement('div');
        kit.className = 'moving-kit';
        kit.style.left = Math.random() * 100 + 'vw';
        kit.style.animationDelay = Math.random() * 20 + 's';
        kit.style.opacity = Math.random() * 0.4;
        container.appendChild(kit);
    }
}

// #3 Fix: Loading Check
async function init() {
    try {
        const [r, h] = await Promise.all([
            fetch('rankings.json').then(res => res.json()),
            fetch('hof.json').then(res => res.json())
        ]);
        DATA = r;
        buildOverall();
        genButtons();
        render("Overall");
        
        // Load HOF
        document.getElementById('hofDisplay').innerHTML = h.map(x => `
            <div class="tier-col" style="padding:20px;">
                <h3 style="color:var(--purple); margin-top:0;">${x.name}</h3>
                <p>${x.description}</p>
            </div>
        `).join('');
    } catch(err) {
        console.error(err);
        document.getElementById('tierDisplay').innerHTML = "ERROR: Failed to load JSON. Use a local server or GitHub Pages.";
    }
}

function buildOverall() {
    const weights = { "HT1":10, "LT1":9, "HT2":8, "LT2":7, "HT3":6, "LT3":5 };
    for(let k in DATA) {
        if(k === "Players" || k === "Overall") continue;
        for(let t in DATA[k]) {
            DATA[k][t].forEach(name => { OVERALL[name] = (OVERALL[name] || 0) + (weights[t] || 0); });
        }
    }
}

function genButtons() {
    const bar = document.getElementById('kitBar');
    ["Overall", ...Object.keys(DATA).filter(k => k!=="Players" && k!=="Overall")].forEach(k => {
        const b = document.createElement('button');
        b.className = 'kit-btn'; b.innerText = k;
        b.onclick = () => {
            document.querySelectorAll('.kit-btn').forEach(x => x.classList.remove('active'));
            b.classList.add('active');
            curKit = k; render(k);
        };
        if(k === "Overall") b.classList.add('active');
        bar.appendChild(b);
    });
}

function render(kit, filter="") {
    const out = document.getElementById('tierDisplay');
    if(kit === "Overall") {
        let sorted = Object.entries(OVERALL).sort((a,b)=>b[1]-a[1]);
        out.innerHTML = sorted.map(([n, p], i) => {
            if(filter && !n.toLowerCase().includes(filter)) return '';
            return `<div class="p-row" onclick="openP('${n}')"><span>#${i+1} ${n}</span><span>${p} PTS</span></div>`;
        }).join('');
    } else {
        let html = `<div class="tier-scroll">`;
        ["HT1","LT1","HT2","LT2","HT3","LT3"].forEach(t => {
            html += `<div class="tier-col"><div class="tier-label">${t}</div>`;
            (DATA[kit][t] || []).forEach(n => {
                if(filter && !n.toLowerCase().includes(filter)) return;
                html += `<div class="p-row" onclick="openP('${n}')">${n}</div>`;
            });
            html += `</div>`;
        });
        out.innerHTML = html + `</div>`;
    }
}

function openP(n) {
    const p = DATA.Players[n] || {};
    document.getElementById('modalName').innerText = n;
    let tiers = "";
    for(let k in DATA) {
        if(k==="Players" || k==="Overall") continue;
        for(let t in DATA[k]) if(DATA[k][t].includes(n)) tiers += `<div>${k}: ${t}</div>`;
    }
    document.getElementById('modalStats').innerHTML = `
        <div style="color:var(--purple); margin-bottom:10px;">${p.region || '??'} PLAYER</div>
        <div style="margin-bottom:20px;">GLOBAL POINTS: ${OVERALL[n] || 0}</div>
        <div style="text-align:left; border-top:1px solid #333; padding-top:10px;">${tiers || 'No active rankings.'}</div>
    `;
    document.getElementById('pModal').style.display = 'flex';
}

function closeP() { document.getElementById('pModal').style.display = 'none'; }
function doSearch() { render(curKit, document.getElementById('mainSearch').value.toLowerCase()); }
function showTab(id) {
    ['rankings','info','hof'].forEach(t => document.getElementById(t+'-tab').style.display = (t===id?'block':'none'));
    document.querySelectorAll('.nav-link').forEach(l => l.classList.toggle('active', l.innerText.toLowerCase().includes(id)));
}

createKits(); init();
</script>
</body>
</html>
